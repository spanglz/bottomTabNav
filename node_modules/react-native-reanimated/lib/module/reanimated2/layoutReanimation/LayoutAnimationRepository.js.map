{"version":3,"names":["runOnUI","withStyleAnimation","ColorProperties","processColor","configs","Object","create","enteringAnimationForTag","global","LayoutAnimationRepository","registerConfig","tag","config","removeConfig","startAnimationForTag","type","yogaValues","style","currentAnimation","animations","entryAniamtion","layoutAnimation","key","sv","_stopObservingProgress","_startObservingProgress","backupColor","initialValues","includes","value","assign","_value","animation","callback","finished"],"sources":["LayoutAnimationRepository.ts"],"sourcesContent":["/* global _stopObservingProgress, _startObservingProgress */\nimport { runOnUI } from '../core';\nimport { withStyleAnimation } from '../animation/styleAnimation';\nimport { ColorProperties } from '../UpdateProps';\nimport { processColor } from '../Colors';\n\nrunOnUI(() => {\n  'worklet';\n\n  const configs: Record<string, any> = Object.create(null);\n  const enteringAnimationForTag: Record<string, any> = {};\n\n  global.LayoutAnimationRepository = {\n    configs,\n    registerConfig(tag, config) {\n      configs[tag] = config;\n      enteringAnimationForTag[tag] = null;\n    },\n    removeConfig(tag) {\n      delete configs[tag];\n      delete enteringAnimationForTag[tag];\n    },\n    startAnimationForTag(tag, type, yogaValues) {\n      if (configs[tag] == null) {\n        return; // :(\n      }\n      const style = configs[tag][type](yogaValues);\n      let currentAnimation = style.animations;\n      if (type === 'entering') {\n        enteringAnimationForTag[tag] = style;\n      } else if (type === 'layout' && enteringAnimationForTag[tag] !== null) {\n        const entryAniamtion = enteringAnimationForTag[tag].animations;\n        const layoutAnimation = style.animations;\n        currentAnimation = {};\n        for (const key in entryAniamtion) {\n          currentAnimation[key] = entryAniamtion[key];\n        }\n        for (const key in layoutAnimation) {\n          currentAnimation[key] = layoutAnimation[key];\n        }\n      }\n\n      const sv: { value: boolean; _value: boolean } = configs[tag].sv;\n      _stopObservingProgress(tag, false);\n      _startObservingProgress(tag, sv);\n\n      const backupColor: Record<string, string> = {};\n      for (const key in style.initialValues) {\n        if (ColorProperties.includes(key)) {\n          const value = style.initialValues[key];\n          backupColor[key] = value;\n          style.initialValues[key] = processColor(value);\n        }\n      }\n\n      sv.value = Object.assign({}, sv._value, style.initialValues);\n      _stopObservingProgress(tag, false);\n      const animation = withStyleAnimation(currentAnimation);\n\n      animation.callback = (finished?: boolean) => {\n        if (finished) {\n          _stopObservingProgress(tag, finished);\n        }\n        style.callback && style.callback(finished);\n      };\n\n      if (backupColor) {\n        configs[tag].sv._value = { ...configs[tag].sv.value, ...backupColor };\n      }\n\n      configs[tag].sv.value = animation;\n      _startObservingProgress(tag, sv);\n    },\n  };\n})();\n"],"mappings":"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"}