{"version":3,"names":["jestResetJsReanimatedModule","config","fps","isAnimatedStyle","style","animatedStyle","getAnimatedStyleFromObject","current","value","getCurrentStyle","received","styleObject","props","currentStyle","Array","isArray","forEach","checkEqual","expectStyle","length","i","property","findStyleDiff","expect","requireAllMatch","diffs","isEqual","push","Object","keys","undefined","compareStyle","expectedStyle","message","pass","exact","currentStyleStr","JSON","stringify","expectedStyleStr","differences","map","diff","join","frameTime","requestAnimationFrameCopy","currentTimestamp","requestAnimationFrame","callback","setTimeout","beforeTest","global","ReanimatedDataMock","now","jest","useFakeTimers","afterTest","useRealTimers","tickTravel","advanceTimersByTime","withReanimatedTimer","animationTest","advanceAnimationByTime","time","Math","ceil","advanceAnimationByFrame","count","setUpTests","userConfig","require","_","expectModule","round","extend","toHaveAnimatedStyle","getAnimatedStyle"],"sources":["jestUtils.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\nimport { jestResetJsReanimatedModule } from './core';\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  namespace jest {\n    interface Matchers<R> {\n      toHaveAnimatedStyle(\n        style: Record<string, unknown>[] | Record<string, unknown>\n      ): R;\n    }\n  }\n}\n\nlet config = {\n  fps: 60,\n};\n\nconst isAnimatedStyle = (style) => {\n  return !!style.animatedStyle;\n};\n\nconst getAnimatedStyleFromObject = (style) => {\n  return style.animatedStyle.current.value;\n};\n\nconst getCurrentStyle = (received) => {\n  const styleObject = received.props.style;\n  let currentStyle = {};\n  if (Array.isArray(styleObject)) {\n    received.props.style.forEach((style) => {\n      if (isAnimatedStyle(style)) {\n        currentStyle = {\n          ...currentStyle,\n          ...getAnimatedStyleFromObject(style),\n        };\n      } else {\n        currentStyle = {\n          ...currentStyle,\n          ...style,\n        };\n      }\n    });\n  } else {\n    if (isAnimatedStyle(styleObject)) {\n      currentStyle = getAnimatedStyleFromObject(styleObject);\n    } else {\n      currentStyle = {\n        ...styleObject,\n        ...received.props.animatedStyle.value,\n      };\n    }\n  }\n  return currentStyle;\n};\n\nconst checkEqual = (currentStyle, expectStyle) => {\n  if (Array.isArray(expectStyle)) {\n    if (expectStyle.length !== currentStyle.length) return false;\n    for (let i = 0; i < currentStyle.length; i++) {\n      if (!checkEqual(currentStyle[i], expectStyle[i])) {\n        return false;\n      }\n    }\n  } else if (typeof currentStyle === 'object' && currentStyle) {\n    for (const property in expectStyle) {\n      if (!checkEqual(currentStyle[property], expectStyle[property])) {\n        return false;\n      }\n    }\n  } else {\n    return currentStyle === expectStyle;\n  }\n  return true;\n};\n\nconst findStyleDiff = (current, expect, requireAllMatch) => {\n  const diffs = [];\n  let isEqual = true;\n  for (const property in expect) {\n    if (!checkEqual(current[property], expect[property])) {\n      isEqual = false;\n      diffs.push({\n        property: property,\n        current: current[property],\n        expect: expect[property],\n      });\n    }\n  }\n\n  if (\n    requireAllMatch &&\n    Object.keys(current).length !== Object.keys(expect).length\n  ) {\n    isEqual = false;\n    for (const property in current) {\n      if (expect[property] === undefined) {\n        diffs.push({\n          property: property,\n          current: current[property],\n          expect: expect[property],\n        });\n      }\n    }\n  }\n\n  return { isEqual, diffs };\n};\n\nconst compareStyle = (received, expectedStyle, config) => {\n  if (!received.props.style) {\n    return { message: () => message, pass: false };\n  }\n  const { exact } = config;\n  const currentStyle = getCurrentStyle(received);\n  const { isEqual, diffs } = findStyleDiff(currentStyle, expectedStyle, exact);\n\n  if (isEqual) {\n    return { message: () => 'ok', pass: true };\n  }\n\n  const currentStyleStr = JSON.stringify(currentStyle);\n  const expectedStyleStr = JSON.stringify(expectedStyle);\n  const differences = diffs\n    .map(\n      (diff) =>\n        `- '${diff.property}' should be ${JSON.stringify(\n          diff.expect\n        )}, but is ${JSON.stringify(diff.current)}`\n    )\n    .join('\\n');\n\n  return {\n    message: () =>\n      `Expected: ${expectedStyleStr}\\nReceived: ${currentStyleStr}\\n\\nDifferences:\\n${differences}`,\n    pass: false,\n  };\n};\n\nlet frameTime = 1000 / config.fps;\nlet requestAnimationFrameCopy;\nlet currentTimestamp = 0;\n\nconst requestAnimationFrame = (callback) => {\n  setTimeout(callback, frameTime);\n};\n\nconst beforeTest = () => {\n  jestResetJsReanimatedModule();\n  requestAnimationFrameCopy = global.requestAnimationFrame;\n  global.requestAnimationFrame = requestAnimationFrame;\n  global.ReanimatedDataMock = {\n    now: () => currentTimestamp,\n  };\n  currentTimestamp = 0;\n  jest.useFakeTimers();\n};\n\nconst afterTest = () => {\n  jest.useRealTimers();\n  global.requestAnimationFrame = requestAnimationFrameCopy;\n};\n\nconst tickTravel = () => {\n  currentTimestamp += frameTime;\n  jest.advanceTimersByTime(frameTime);\n};\n\nexport const withReanimatedTimer = (animationTest) => {\n  beforeTest();\n  animationTest();\n  afterTest();\n};\n\nexport const advanceAnimationByTime = (time = frameTime) => {\n  for (let i = 0; i <= Math.ceil(time / frameTime); i++) {\n    tickTravel();\n  }\n  jest.advanceTimersByTime(frameTime);\n};\n\nexport const advanceAnimationByFrame = (count) => {\n  for (let i = 0; i <= count; i++) {\n    tickTravel();\n  }\n  jest.advanceTimersByTime(frameTime);\n};\n\nexport const setUpTests = (userConfig = {}) => {\n  let expect;\n  try {\n    expect = require('expect');\n  } catch (_) {\n    // for Jest in version 28+\n    const { expect: expectModule } = require('@jest/globals');\n    expect = expectModule;\n  }\n\n  require('setimmediate');\n  frameTime = Math.round(1000 / config.fps);\n\n  config = {\n    ...config,\n    ...userConfig,\n  };\n\n  expect.extend({\n    toHaveAnimatedStyle(received, expectedStyle, config = {}) {\n      return compareStyle(received, expectedStyle, config);\n    },\n  });\n};\n\nexport const getAnimatedStyle = (received) => {\n  return getCurrentStyle(received);\n};\n"],"mappings":"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"}